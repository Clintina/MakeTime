<h2>What do you want to make time for?</h2>

<form method="post" action="{% url 'make_time_for' %}">
  {% csrf_token %}
  {{ formset.management_form }}
  {% for form in formset %}
    <div class="form-block" style="margin-bottom: 20px;">
      {{ form.id }} 
      {{ form.category.label_tag }} {{ form.category }}
      {{ form.label.label_tag }} {{ form.label }}

      <div class="person-fields" style="display: none;">
        <label for="{{ form.contact_name.id_for_label }}">Person's Name:</label>
        {{ form.contact_name }}
        <label for="{{ form.phone_number.id_for_label }}">Phone Number:</label>
        {{ form.phone_number }}
      </div>

      <div class="other-fields" style="display: none;">
        <label for="color-{{ forloop.counter }}">Color:</label>
        <input type="color" name="color-{{ forloop.counter }}" id="color-{{ forloop.counter }}">
      </div>

      {{ form.DELETE }} Delete
    </div>
  {% endfor %}
  <button type="submit">Continue</button>
</form>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const blocks = document.querySelectorAll(".form-block");

    blocks.forEach(block => {
      const categorySelect = block.querySelector("select");
      const personFields = block.querySelector(".person-fields");
      const otherFields = block.querySelector(".other-fields");

      function toggleFields() {
        const value = categorySelect.value;
        if (value === "person") {
          personFields.style.display = "block";
          otherFields.style.display = "none";
        } else {
          personFields.style.display = "none";
          otherFields.style.display = "block";
        }
      }

      categorySelect.addEventListener("change", toggleFields);
      toggleFields(); // initialize on load
    });
  });
</script>